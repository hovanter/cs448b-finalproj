<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <link rel="stylesheet" type="text/css" href="css/skeleton/normalize.css">
  <link rel="stylesheet" type="text/css" href="css/skeleton/skeleton.css">
  <script src="scripts/jquery-1.12.3.min.js"></script>
  <title>Configure</title>
</head>
<body>
  <div class="container">
    <!-- Instruction section -->
    <div class="row">
      <br />
      <h3>2. Tell us a litle about your data:</h3>
      <p>Tag your column types. This will help us find the best way to visualize your data.</p>
      <code>TODO: Figure out exactly what kind of tags we want and populate this table below.</code>
      <table class="u-full-width">
        <thead>
          <tr>
            <th>Tag</th>
            <th>Detail</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><i>Ordinal</i></td>
            <td>Ordinal means...</td>
          </tr>
          <tr>
            <td><i>Nominal</i></td>
            <td>Nominal means...</td>
          </tr>
          <tr>
            <td><i>Interactive</i></td>
            <td>Interactive means...</td>
          </tr>
          <tr>
            <td><i>Static</i></td>
            <td>Static means...</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Main content section -->
    <div class="row">
      <div><code>TODO: display data columns here, create a way of tagging columns.</code></div>
    </div>

    <!-- Navigation section...put buttons here -->
    <div class="row">
      <br />
      <a class="button button-primary" href="index.html">Previous</a>
      <a class="button button-primary" href="visualization.html" onclick="populateFilters()">Next</a>
    </div>
  </div>

  <div class="container">
  <table class="u-full-width">
    <thead>
      <tr>
        <th>Category</th>
        <th>Data Type</th>
        <th>Interactivity</th>
      </tr>
    </thead>
    <tbody id="data-body">
    </tbody>
  </table>
  </div>
<!-- Fetch user data -->
<script>

  // @andrei: Do stuff with user data to dynamically generate the data columns (See TODO above)
  //assume JSON of form {data: [{cat1:val1, cat2:val2}, {cat1:val1, cat2:val2}}
  var userData = JSON.parse(sessionStorage.data);
  var datumObject = userData['data'][0];
  var dataHtml = '<form action="">'+
    '<input type="radio" name="data-type" value="Ordinal">' +
    ' Ordinal<input type="radio" name="data-type"'+ 
    ' value="Nominal"> Nominal</form>';
  var interactiveHtml = '<form action="">'+
    '<input type="radio" name="interactive" value="Interactive">'+
    ' Yes<input type="radio" name="interactive" value="nonInteractive">'+
    ' No</form>';

  for(var key in datumObject){
    $('#data-body').append('<tr><td>' + key + '</td><td>'+ dataHtml +'</td><td>'+ interactiveHtml+'</td></tr>');
  }



  (function newNames(){
    var tableBody = document.getElementById("data-body");
    for (var i = 0, row; row = tableBody.rows[i]; i++) {
      for (var j = 0, col; col = row.cells[j]; j++) {
        if(col.childNodes[0].nodeType === 3){
          continue;
        }
        else{
          for(var k = 0; k < col.childNodes[0].children.length; k++){
            col.childNodes[0].children[k].name = col.childNodes[0].children[k].name + i.toString();
          }
        } 
      }
    }
  })();

  var allFilters = {Ordinal:[], Nominal:[],Interactive:[],nonInteractive:[]};
  function populateFilters(){
    var tableBody = document.getElementById("data-body");
    for (var i = 0, row; row = tableBody.rows[i]; i++) {
      var catName;
      for (var j = 0, col; col = row.cells[j]; j++) {
        if(col.childNodes[0].nodeType === 3){
          catName = col.childNodes[0].data; //text

        } 
        else{
          var radioGroup = col.childNodes[0].children[0].name
          if ($('input[name=' + radioGroup + ']:checked').length > 0) {
            var radioValue = $('input[name=' + radioGroup + ']:checked').val();
            allFilters[radioValue].push(catName);
          }
        }
      }  
    }
    sessionStorage.setItem('filters', JSON.stringify(allFilters));
  }
    
  


</script>
</body>
</html>